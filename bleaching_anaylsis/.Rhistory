dat_max_dhw_2019_sites <- read.csv("../data/max_dhw_2019.csv")
dat_change_coral_cover <- dat_coral_cover %>%
filter(year >= 2019, year <= 2020) %>%
group_by(site, year) %>%
summarise(percent = mean(percent)) %>%
pivot_wider(names_from = year,
values_from = percent) %>%
# calculate relative change
mutate(rel_change = 100*(`2019` - `2020`)/`2019`) %>%
select(-`2020`, -`2019`) %>%
ungroup()
library(tidyverse)
dat_coral_cover <- read.csv("../data/coral_cover.csv")
dat_change_coral_cover <- dat_coral_cover %>%
filter(year >= 2019, year <= 2020) %>%
group_by(site, year) %>%
summarise(percent = mean(percent)) %>%
pivot_wider(names_from = year,
values_from = percent) %>%
# calculate relative change
mutate(rel_change = 100*(`2019` - `2020`)/`2019`) %>%
select(-`2020`, -`2019`) %>%
ungroup()
dat_change_coral_cover <- left_join(dat_change_coral_cover,
dat_max_dhw_2019_sites,
by = "site")
dat_change_coral_cover <- left_join(dat_change_coral_cover,
dat_max_dhw_2019_sites,
by = "site")
dat_change_coral_cover
library(tidyverse)
dat_coral_cover <- read.csv("../data/coral_cover.csv")
dat_change_coral_cover <- dat_coral_cover %>%
filter(year >= 2019, year <= 2020) %>%
group_by(site, year) %>%
summarise(percent = mean(percent)) %>%
pivot_wider(names_from = year,
values_from = percent) %>%
# calculate relative change
mutate(rel_change = 100*(`2019` - `2020`)/`2019`) %>%
select(-`2020`, -`2019`) %>%
ungroup()
dat_max_dhw_2019_sites <- read.csv("../data/max_dhw_2019.csv")
dat_change_coral_cover <- left_join(dat_change_coral_cover,
dat_max_dhw_2019_sites,
by = "site")
dat_max_dhw_2019_sites
dat_max_dhw_2019_sites <- read.csv("../data/max_dhw_2019_sites.csv")
dat_change_coral_cover <- left_join(dat_change_coral_cover,
dat_max_dhw_2019_sites,
by = "site")
m_change_coral_cover <- lm(rel_change ~ max_dhw,
data = dat_change_coral_cover)
summarise(m_change_coral_cover)
m_change_coral_cover <- lm(rel_change ~ max_dhw,
data = dat_change_coral_cover)
summary(m_change_coral_cover)
plot_coralcover_dhwmax <- ggplot(mapping = aes(x = max_dhw))+
# Plot SE
geom_ribbon(data = pred_coralcover_dhw,
aes(ymin = fit - se.fit,
ymax = fit + se.fit),
fill = "grey")+
#Plot model
geom_line(data = pred_coralcover_dhw,
aes(y = fit),
col = "darkred", linewidth = 1.2)+
# Plot raw data
geom_point(data = dat_change_coral_cover,
aes(y = rel_change), size = 4)
library(tidyverse)
dat_coral_cover <- read.csv("../data/coral_cover.csv")
dat_change_coral_cover <- dat_coral_cover %>%
filter(year >= 2019, year <= 2020) %>%
group_by(site, year) %>%
summarise(percent = mean(percent)) %>%
pivot_wider(names_from = year,
values_from = percent) %>%
# calculate relative change
mutate(rel_change = 100*(`2019` - `2020`)/`2019`) %>%
select(-`2020`, -`2019`) %>%
ungroup()
dat_max_dhw_2019_sites <- read.csv("../data/max_dhw_2019_sites.csv")
dat_change_coral_cover <- left_join(dat_change_coral_cover,
dat_max_dhw_2019_sites,
by = "site")
m_change_coral_cover <- lm(rel_change ~ max_dhw,
data = dat_change_coral_cover)
summary(m_change_coral_cover)
ndat_coralcover_dhw <-  data.frame(max_dhw = seq(min(dat_change_coral_cover$max_dhw),
max(dat_change_coral_cover$max_dhw),
length = 100))
pred_coralcover_dhw  <- predict(m_change_coral_cover,
newdata = ndat_coralcover_dhw,
se.fit = T) %>%
bind_cols(ndat_coralcover_dhw)
plot_coralcover_dhwmax <- ggplot(mapping = aes(x = max_dhw))+
# Plot SE
geom_ribbon(data = pred_coralcover_dhw,
aes(ymin = fit - se.fit,
ymax = fit + se.fit),
fill = "grey")+
#Plot model
geom_line(data = pred_coralcover_dhw,
aes(y = fit),
col = "darkred", linewidth = 1.2)+
# Plot raw data
geom_point(data = dat_change_coral_cover,
aes(y = rel_change), size = 4) +
# Formatting
labs(x = expression(DWH[max]),
y = expression(Delta~Relative~cover~"(%)"))+
theme_light()+
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
# show plot
plot_coralcover_dhwmax
ggsave(filename = "coralcover_dhwmax.pdf",    # chose filename and file format (.png, .svg, .jpg, etc.)
plot = plot_coralcover_dhwmax,         # chose plot that should be saved
width = 17 ,height = 8, units = "cm",  # chose size of saved plot
path = "../plots")                     # location where plot should be saved
dat_coral_cover <- read.csv("../data/coralgenus_cover.csv")
View(dat_coral_cover)
dat_coral_cover <- read.csv("../data/coralgenus_cover.csv")
View(dat_change_coral_cover)
View(m_change_coral_cover)
View(dat_coral_cover)
dat_coral_cover_genus <- read.csv("../data/coralgenus_cover.csv")
View(dat_coral_cover_genus)
dat_coral_cover_genus <- dat_coral_cover_genus %>%
filter(genus != "other")
View(dat_coral_cover)
View(dat_coral_cover)
View(dat_coral_cover_genus)
dat_coral_cover_genus <- dat_coral_cover_genus %>%
filter(______ != ______)
